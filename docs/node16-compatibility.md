# Совместимость с Node.js 16.20.2

Этот файл описывает особенности проекта, влияющие на поддержку Node.js 16.20.2, и содержит чек-лист проверок перед релизом.

## Используемые возможности платформы

- **ES Modules** — код поставляется в формате ESM (`"type": "module"`). Node.js 16.20.2 полностью поддерживает его без флагов.
- **Глобальный `fetch` и Web Streams** — в Node.js 16.20.2 отсутствует встроенная реализация. Полифилл подключается через `src/polyfills/fetch.js`, который экспортирует `fetch`, `Request`, `Response`, `Headers` и классы `ReadableStream`/`WritableStream`/`TransformStream` из `node-fetch@3` и `web-streams-polyfill`.
- **API `URL` и `Buffer`** — используются нативные реализации Node.js и поддерживаются без ограничений.

## Переключение окружения

```bash
nvm install 16.20.2     # однократно, если версия не установлена
nvm use 16.20.2
npm install             # установка зависимостей с учётом новой версии Node.js
```

После переключения убедитесь, что переменные окружения заданы (см. раздел «Подготовка окружения» в README).

## Автоматические проверки

1. `npm run lint` — статический анализ кода.
2. `npm test` — модульные и интеграционные тесты Vitest (эмулируют регистрацию курьера/администратора, загрузку XLSX и рассылку карточек).

Обе команды должны завершаться успешно под Node.js 16.20.2.

## Ручные сценарии регрессии

При необходимости дополнительно выполните сценарии из [docs/manual-scenarios.md](./manual-scenarios.md). Они покрывают регистрацию курьера, админский режим и повторные выдачи карточек. Для проверки загрузки XLSX и рассылки используйте тестовый администратор и убедитесь, что бот формирует отчёт без ошибок.

## Перед релизом

- Проверьте, что файл `package.json` содержит требование `"node": ">=16.20.2"`.
- Убедитесь, что README и внутренняя документация ссылаются на этот чек-лист.
- Зафиксируйте вывод `node -v` и `npm -v` в журнале релиза или CI.
